<!DOCTYPE html>
<html>

<head>
	<title>Dynamic Graph</title>
	<!-- <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>	 -->
	<script type="text/javascript" src="vis-network.min.js"></script>
	<link href="data:image/x-icon;base64,YourBase64StringHere" rel="icon" type="image/x-icon" />
	<meta name="viewport"
		content="user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, minimal-ui">
	<style>
		#network {
			width: 100%;
			height: 1000px;
			border: 1.618px solid lightgray;
		}
	</style>
</head>

<body>
	<h2>Dynamic Graph</h2>
	<div id="network"></div>
	<button onclick="addEdge()">Add Edge</button>
	<button id="toggle_button" onclick="toggle()">Toggle</button>

	<script>

		// Create nodes and edges datasets
		let topic = 'pg'; // Replace with your topic
		let graph_name = 'pg'; // Replace with your graph name
		let queue = [759389];

		let go = false;

		const nodes = new vis.DataSet([]);
		const edges = new vis.DataSet([]);

		function addNode(id, color = undefined) {
			let n = { id: id, label: id.toString() };
			if (color) {
				n.color = { background: color };
			}
			nodes.add(n);
		}

		queue.forEach(node => { addNode(node, 'white'); });

		// Create a network
		const container = document.getElementById('network');
		const data = { nodes, edges };
		const options = {};
		const network = new vis.Network(container, data, options);

		let sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

		function toggle() {
			go = !go;
			document.getElementById('toggle_button').innerText = go ? 'Pause' : 'Resume';
		}

		toggle(); // Initial toggle to set the state

		async function addEdge() {

			while (go && queue.length > 0) {

				let each = queue.shift();
				let response = await fetch(`/webgraph-api/neighborhood/${topic}/${graph_name}/${each}`)
					.then(response => response.json())
					.catch(error => console.error('Error fetching neighbors:', error));

				nodes.update([{ id: each, color: { background: 'lightgray' } }]);

				response.neighborhood.forEach(async neighbor => {

					if (!nodes.get(neighbor)) {
						addNode(neighbor); // Add the neighbor node if it doesn't exist

						queue.push(neighbor);

					} else {
						console.log(`Already seen node ${neighbor}`);
					}

					edges.add({ from: each, to: neighbor, arrows: 'to' });

					await sleep(618); // Sleep for 100 milliseconds to avoid overwhelming the browser

				});
			}
		}

		// addEdge(); // Initial call to start adding edges
	</script>
</body>

</html>